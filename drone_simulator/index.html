<html>
<head>
    <title>Final Project - OK</title>

    <style>
    	body{
    		margin: 0;
    		overflow: hidden;
    	}
    </style>
</head>
<body>

    <div class="label">x: <span class="text" id="posx">0</span></div>
    <div class="label">y: <span class="text" id="posy">0</span></div>
    <div class="label">z: <span class="text" id="posz">0</span></div>

    <canvas id="myCanvas"></canvas>

    <script src="three.js"></script>
    <script src="GLTFLoader.js"></script>

    <script>
  //  var music = new Audio("sound/If_I_Had_a_Chicken.mp3");

    var player = { height:1.0}
    var renderer,
    	scene,
    	camera,
    	myCanvas = document.getElementById('myCanvas');

    //RENDERER
    renderer = new THREE.WebGLRenderer({
      canvas: myCanvas, 
      antialias: true
    });
    renderer.setClearColor(0x55e7ff);
    renderer.setPixelRatio(window.devicePixelRatio);
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.shadowMap.enabled = true;
    renderer.shadowMap.type = THREE.BasicShadowMap;

    //CAMERA
    camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000 );

    camera.position.set(-20, 6, 34);
    // camera.position.set(0, 36, 4);
    camera.lookAt(new THREE.Vector3(0,0,0)); 

    //SCENE
    scene = new THREE.Scene();

    //GROUND PLANE
    var planeGeometry = new THREE.PlaneGeometry(100,100,100,100); 
    var planeMaterial = new THREE.MeshPhongMaterial({color: 0xc0c0c0, wireframe:false}); 
    plane = new THREE.Mesh(planeGeometry,planeMaterial);
    plane.rotation.x -= Math.PI / 2;
    plane.receiveShadow = true;
    scene.add( plane );

    //LIGHTS
    var light = new THREE.AmbientLight(0xffffff, 0.5);
    scene.add(light);

    var light2 = new THREE.PointLight(0xffffff, 0.5);
    light2.position.set(0, 100, 20);
    light2.castShadow = true;
    light2.shadow.camera.near = 0.1;
    light2.shadow.camera.far = 25;
    scene.add(light2);
  
    var spotLight = new THREE.SpotLight( 0xffffff );
    spotLight.position.set( 0, 100, 10 );

    spotLight.castShadow = true;

    spotLight.shadow.mapSize.width = 1024;
    spotLight.shadow.mapSize.height = 1024;

    spotLight.shadow.camera.near = 0.1;
    spotLight.shadow.camera.far = 50;
    spotLight.shadow.camera.fov = 30;

    scene.add( spotLight );

    //FOG
    // scene.fog=new THREE.FogExp2( 0xffffff, 0.01 );

    var loader = new THREE.GLTFLoader();

    loader.load('objects/pine_tree/scene.gltf', handle_tree);
    loader.load('objects/pine_tree/scene.gltf', handle_tree1);
    loader.load('objects/pine_tree/scene.gltf', handle_tree11);
    loader.load('objects/pine_tree/scene.gltf', handle_tree111);
    loader.load('objects/pine_tree/scene.gltf', handle_tree1111);
    loader.load('objects/pine_tree/scene.gltf', handle_tree11111);
    loader.load('objects/pine_tree/scene.gltf', handle_tree111111);
    loader.load('objects/pine_tree/scene.gltf', handle_tree1111111);
    loader.load('objects/glb/tree_sheinna1.glb', handle_tree2);
    loader.load('objects/glb/tree_sheinna2.glb', handle_tree3);
    loader.load('objects/apple_tree/scene.gltf', handle_tree4);
    loader.load('objects/apple_tree/scene.gltf', handle_tree41);
    loader.load('objects/pine_tree/scene.gltf', handle_tree5);
    loader.load('objects/pine_tree/scene.gltf', handle_tree51);
    loader.load('objects/pine_tree/scene.gltf', handle_tree511);
    loader.load('objects/pine_tree/scene.gltf', handle_tree5111);
    loader.load('objects/simple_tree/scene.gltf', handle_tree6);
    loader.load('objects/simple_tree/scene.gltf', handle_tree61);
    loader.load('objects/simple_tree/scene.gltf', handle_tree611);
    loader.load('objects/spruce_tree/scene.gltf', handle_tree7);
    loader.load('objects/spruce_tree2/scene.gltf', handle_tree8);
    loader.load('objects/spruce_tree2/scene.gltf', handle_tree81);
    loader.load('objects/bench/scene.gltf', handle_bench);
    loader.load('objects/bench/scene.gltf', handle_bench1);
    loader.load('objects/bench/scene.gltf', handle_bench2);
    loader.load('objects/rocks/scene.gltf', handle_rocks);

    loader.load('objects/yulia/store.glb', handle_build1);
    loader.load('objects/yulia/store.glb', handle_build11);
    loader.load('objects/yulia/store3.glb', handle_build12);
    loader.load('objects/yulia/building.glb', handle_build2);
    loader.load('objects/yulia/building.glb', handle_build21);
    loader.load('objects/yulia/building2.glb', handle_build22);
    loader.load('objects/yulia/Apartment.glb', handle_build3);
    loader.load('objects/yulia/Apartment.glb', handle_build31);
    loader.load('objects/yulia/gedung.glb', handle_build4);
    loader.load('objects/yulia/gedung.glb', handle_build41);
    loader.load('objects/yulia/gedung.glb', handle_build411);
    loader.load('objects/yulia/gedung.glb', handle_build4111);
    loader.load('objects/yulia/GasStation.glb', handle_build5);
    loader.load('objects/yulia/Apartment2.glb', handle_build6);
    loader.load('objects/yulia/Apartment2.glb', handle_build61);
    loader.load('objects/yulia/Apartment4.glb', handle_build8);
    loader.load('objects/yulia/Apartment4.glb', handle_build81);
    loader.load('objects/yulia/town.glb', handle_builda11);
  
  
    loader.load('objects/car/car1/scene.gltf', handle_car1);
    loader.load('objects/car/car1/scene.gltf', handle_car11);
    loader.load('objects/car/car1/scene.gltf', handle_car111);
    loader.load('objects/car/cars.glb', handle_car2);
    loader.load('objects/car/pemadam.glb', handle_car3);
    loader.load('objects/car/offroadcar.glb', handle_car4);


    var mesh, bench_mesh, cloud_mesh, rocks_mesh, car_mesh;

    //load biasa
    function handle_load(gltf, x, y, z,sc, mesh) {
        console.log(gltf);
        mesh = gltf.scene;
        console.log(mesh.children[0]);
        mesh.children[0].material = new THREE.MeshLambertMaterial();
        mesh.scale.set(sc, sc, sc);    
        mesh.position.z = z;
        mesh.position.x = x;
        mesh.position.y = y;
        mesh.castShadow = true;
        mesh.receiveShadow = true;
		scene.add( mesh );
    }
    
    // ada rotate x, y
    function handle_load2(gltf, x, y, z,xr, yr, sc, mesh) {
        console.log(gltf);
        mesh = gltf.scene;
        console.log(mesh.children[0]);
        mesh.children[0].material = new THREE.MeshLambertMaterial();
        mesh.scale.set(sc, sc, sc);    
        mesh.position.z = z;
        mesh.position.x = x;
        mesh.position.y = y;
        mesh.rotation.x = xr;
        mesh.rotation.y = yr;
        mesh.castShadow = true;
        mesh.receiveShadow = true;
		scene.add( mesh );
    }

    //ada scale x,y,z
    function handle_load3(gltf, x, y, z,xr, yr, sca, scb, scc, mesh) {
        console.log(gltf);
        mesh = gltf.scene;
        console.log(mesh.children[0]);
        mesh.children[0].material = new THREE.MeshLambertMaterial();
        mesh.scale.set(sca, scb, scc);    
        mesh.position.z = z;
        mesh.position.x = x;
        mesh.position.y = y;
        mesh.rotation.x = xr;
        mesh.rotation.y = yr;
        mesh.castShadow = true;
        mesh.receiveShadow = true;
		scene.add( mesh );
    }

    function road (x, y, z, ry, scx, scy) {
        var geometry = new THREE.PlaneGeometry( 6, 20, 0 );
        var material = new THREE.MeshPhongMaterial( {color: 0x202020, side: THREE.DoubleSide} );
        var plane2 = new THREE.Mesh( geometry, material );
        plane2.rotation.x -= Math.PI / 2;
        plane2.rotation.z  = ry
        plane2.position.x = x;
        plane2.position.y= y;
        plane2.position.z = z;
        plane2.scale.x = scx;
        plane2.scale.y = scy;
        plane2.receiveShadow = true;
        scene.add( plane2 );
    }

    road (-30, 0.08,  0, 0, 0.5, 5);
    road (-10, 0.08,  0, 0, 0.5, 5);
    road ( 10, 0.08,  0, 0, 0.5, 5);
    road ( 30, 0.08,  0, 0, 0.5, 5);
    road ( 0, 0.08, -30, Math.PI / 2, 0.5, 5);
    road ( 0, 0.08, -10, Math.PI / 2, 0.5, 5);
    road ( 0, 0.08,  10, Math.PI / 2, 0.5, 5);
    road ( 0, 0.08,  30, Math.PI / 2, 0.5, 5);

    function ground (x, y, z, sc, a) {
    var geometry = new THREE.PlaneGeometry( 18, 18, 18 );
    var material = new THREE.MeshBasicMaterial( {color: a, side: THREE.DoubleSide} );
    var plane3 = new THREE.Mesh( geometry, material );
    plane3.rotation.x -= Math.PI / 2;
    plane3.position.x = x;
    plane3.position.y= y;
    plane3.position.z = z;
    plane3.scale.set(sc,sc,sc);
    scene.add( plane3 );
}

ground(-40,  0.1, -40, 0.85, 0x2a6002 );
ground(-40,  0.1, -20, 0.85, 0x2a6002 );
ground(-40,  0.1,   0, 0.85, 0x2a6002 );
ground(-40,  0.1,  20, 0.85, 0x2a6002 );
ground(-40,  0.1,  40, 0.85, 0x2a6002 );
ground(-20,  0.1, -40, 0.85, 0x2a6002 );
ground(-20,  0.1, -20, 0.85, 0x2a6002 );
ground(-20,  0.1,   0, 0.85, 0x2a6002 );
ground(-20,  0.1,  20, 0.85, 0x2a6002 );
ground(-20,  0.1,  40, 0.85, 0x2a6002 );
ground(  0,  0.1, -40, 0.85, 0x2a6002 );
ground(  0,  0.1, -20, 0.85, 0x2a6002 );
ground(  0,  0.1,   0, 0.85, 0x2a6002 );
ground(  0,  0.1,  20, 0.85, 0x2a6002 );
ground(  0,  0.1,  40, 0.85, 0x2a6002 );
ground( 20,  0.1, -40, 0.85, 0x2a6002 );
ground( 20,  0.1, -20, 0.85, 0x2a6002 );
ground( 20,  0.1,   0, 0.85, 0x2a6002 );
ground( 20,  0.1,  20, 0.85, 0x2a6002 );
ground( 20,  0.1,  40, 0.85, 0x2a6002 );
ground( 40,  0.1, -40, 0.85, 0x2a6002 );
ground( 40,  0.1, -20, 0.85, 0x2a6002 );
ground( 40,  0.1,   0, 0.85, 0x2a6002 );
ground( 40,  0.1,  20, 0.85, 0x2a6002 );
ground( 40,  0.1,  40, 0.85, 0x2a6002 );



    function handle_car2(gltf) {
        handle_load2(gltf, -20, -1, 0, 0, 0,  0.6, mesh);
    }
    function handle_car3(gltf) {
        handle_load2(gltf, -20, -1, 0, 0, 0,  0.6, mesh);
    }
    function handle_car4(gltf) {
        handle_load2(gltf, -18, 1, 0, 0, 0,  0.008, mesh);
    }

    // car random
    function handle_car1(gltf) {
        console.log(gltf);
        car_mesh = gltf.scene;
        console.log(car_mesh.children[0]);
        car_mesh.children[0].material = new THREE.MeshLambertMaterial();
        car_mesh.scale.set(0.8, 0.8, 0.8);    
        car_mesh.position.z = -8;
        car_mesh.position.x = 10;
        car_mesh.position.y = 0;
        car_mesh.rotation.x = 0;
        car_mesh.rotation.y = 0;
        car_mesh.castShadow = true;
        car_mesh.receiveShadow = true;
		scene.add( car_mesh );
    }


    //komplek 1a
    function handle_build6(gltf) {
        handle_load2(gltf, -45, 0.2, -45, 0, 1.6, 0.00007, mesh);
    }
    function handle_build8(gltf) {
        handle_load2(gltf, -37.5, 0.2, -45, 0, 1.6, 0.00007, mesh);
    }
    function handle_build411(gltf) {
        handle_load(gltf, -45, -0.3, -38, 0.015, mesh);
    }
    function handle_build4111(gltf) {
        handle_load3(gltf, -42, -1, -38, 0, 0, 0.015, 0.010, 0.015, mesh);
    }
    function handle_tree(gltf) {
        handle_load(gltf, -32.5, -0.3, -46, 0.7, mesh);
    }
    function handle_tree1(gltf) {
        handle_load(gltf, -32.5, -0.3, -42, 0.7, mesh);
    }
    function handle_tree11(gltf) {
        handle_load(gltf, -32.5, -0.3, -38, 0.7, mesh);
    }
    function handle_tree111(gltf) {
        handle_load(gltf, -32.5, -0.3, -34, 0.7, mesh);
    }
    function handle_tree1111(gltf) {
        handle_load(gltf, -36.5, -0.3, -34, 0.7, mesh);
    }
    function handle_tree11111(gltf) {
        handle_load(gltf, -40.5, -0.3, -34, 0.7, mesh);
    }
    function handle_tree111111(gltf) {
        handle_load(gltf, -44.5, -0.3, -34, 0.7, mesh);
    }
    function handle_tree1111111(gltf) {
        handle_load(gltf, -48.5, -0.3, -34, 0.7, mesh);
    }

//komplek 1b
    function handle_builda11(gltf) {
        handle_load3(gltf, -38, 0, -30, 0, 1.58, 0.005, 0.006, 0.004, mesh);
    }

// Komplek 1c
// Komplek 1d
// Komplek 1e
    function handle_tree2(gltf) {
        handle_load(gltf, -32, 0, 34, 1, mesh);
    }

// komplek 2a
    //store
    function handle_build1(gltf) {
        handle_load2(gltf, -24, +0.1, -35, 0, -Math.PI/2, 0.22, mesh);
    }
    //gedung pink
    function handle_build2(gltf) {
        handle_load3(gltf, -16, 0, -36, 0, 1.6, 3, 2, 3.5, mesh);
    }
    //apartement
    function handle_build3(gltf) {
        handle_load2(gltf, -16, 0.2, -45, 0, Math.PI/2 , 0.00008, mesh);
    }
    function handle_build31(gltf) {
        handle_load2(gltf, -24, 0.2, -45, 0, -Math.PI/2, 0.00008, mesh);
    }

    // Komplek 2b
    function handle_tree5(gltf) {
        handle_load(gltf, -27, +0, -14, 0.7, mesh);
    }
    function handle_tree51(gltf) {
        handle_load(gltf, -27, +0, -18, 0.7, mesh);
    }
    function handle_tree511(gltf) {
        handle_load(gltf, -27, +0, -22, 0.7, mesh);
    }
    function handle_tree5111(gltf) {
        handle_load(gltf, -27, +0, -26, 0.7, mesh);
    }
    function handle_tree611(gltf) {
        handle_load(gltf, -13, +0, -16, 0.5, mesh);
    }
    //gedung kecil
    function handle_build4(gltf) {
        handle_load(gltf, -24, -0.3, -14, 0.015, mesh);
    }
    //gedung pink 2
    function handle_build21(gltf) {
        handle_load2(gltf, -18, 0, -15, 0, 1.6, 2, mesh);
    }

// Komplek 2c
// Komplek 2d
// Komplek 2e

// Komplek 3a

// komplek 3b
    //gas station
    function handle_build5(gltf) {
        handle_load2(gltf, 0, 0, -21, 0, 4.72, 0.005, mesh);
    }
    function handle_car111(gltf) {
        handle_load2(gltf, -5, -0.3, -23, 0, 0,  0.8, mesh);
    }
    function handle_tree4(gltf) {
        handle_load(gltf, -22, +0, -20, 2, mesh);
    }
    function handle_build22(gltf) {
        handle_load2(gltf, 4, 0, -15, 0, -Math.PI/2,  0.025, mesh);
    }
    function handle_build12(gltf) {
        handle_load3(gltf, -3, 0.01, -15, 0, -Math.PI/2, 0.25, 0.35, 0.25, mesh);
    }
    function handle_bench1(gltf) {
        handle_load2(gltf, 5, +0.5, -25, 0, Math.PI, 1, bench_mesh);
    }


// Komplek 3c
    function handle_tree8(gltf) {
        handle_load(gltf, -5, +0, -8, 2, mesh);
    }
    function handle_bench2(gltf) {
        handle_load2(gltf, 0, +0.5, 0, 0, Math.PI, 1, bench_mesh);
    }
    function handle_rocks(gltf) {
        handle_load(gltf, 0, +0, 0, 1, rocks_mesh);
    }
    function handle_bench(gltf) {
        handle_load(gltf, 0, +0.5, 0, 1, bench_mesh);
    }
// Komplek 3d
// Komplek 3e

// Komplek 4a
// Komplek 4b
// Komplek 4c
// Komplek 4d
    function handle_build81(gltf) {
        handle_load2(gltf, 25, 0.3, 15, 0, 0, 0.00006, mesh);
    }
    function handle_build11(gltf) {
        handle_load2(gltf, 18, 0, 15, 0, Math.PI/2, 0.22, mesh);
    }
    function handle_car11(gltf) {
        handle_load2(gltf, 14, -0.3, 14, 0, 0,  1, mesh);
    }
    function handle_tree61(gltf) {
        handle_load(gltf, 12, +0, 12, 0.5, mesh);
    }
    function handle_build61(gltf) {
        handle_load2(gltf, 16, 0.3, 21, 0, Math.PI, 0.00007, mesh);
    }
    function handle_build41(gltf) {
        handle_load(gltf, 26, -0.3, 22, 0.015, mesh);
    }
    function handle_tree81(gltf) {
        handle_load(gltf, 21.5, +0, 23, 3, mesh);
    }


// Komplek 4e

// Komplek 5a
    
// Komplek 5b
    function handle_tree7(gltf) {
        handle_load(gltf, 35, +0, -15, 0.7, mesh);
    } 
// Komplek 5c
    function handle_tree3(gltf) {
        handle_load(gltf, 35, +0, 5, 1, mesh);
    }
// Komplek 5d
    function handle_tree6(gltf) {
        handle_load(gltf, 32, +0, 25, 0.3, mesh);
    }
// Komplek 5e
    function handle_tree41(gltf) {
        handle_load(gltf, 30, +0, 45, 1, mesh);
    }













    // var mouse = {x:0,y:0};
    var cameraMoves = {x:0,y:0,z:-0.1,move:false,speed:0.2};


    //RENDER LOOP
    render();

    // function mouseMove(e){
    //     if (e.clientX>mouse.x) { camera.position.x += cameraMoves.speed; } else { camera.position.x += -cameraMoves.speed; }
    //     if (e.clientY>mouse.y) { camera.position.y += -cameraMoves.speed; } else { camera.position.y += cameraMoves.speed; }

    //     mouse.x = e.clientX;
    //     mouse.y = e.clientY;
    // }
    // window.addEventListener('mousemove', mouseMove);

    var delta = 0;
    var prevTime = Date.now();
    var mundur = 0;
    function render() {
        posx = camera.position.x;
        document.getElementById("posx").innerHTML = posx;
        posy = camera.position.y;
        document.getElementById("posy").innerHTML = posy;
        posz = camera.position.z;
        document.getElementById("posz").innerHTML = posz;
        var delta = 0.01;
        var yawMove = 0.001;
        document.addEventListener('keydown',onDocumentKeyDown,false);
        function onDocumentKeyDown(event){
            event = event || window.event;
            var keycode = event.keyCode;
            switch(keycode){
                // Case MOVE
                case 65 : //A Left
                    camera.position.x = camera.position.x - delta;
                    break;
                case 87 : //W Up
                    camera.position.z = camera.position.z - delta;
                    break;
                case 68 : //D Right
                    camera.position.x = camera.position.x + delta;
                    break;
                case 83 : //S Down
                    camera.position.z = camera.position.z + delta;
                    break;
                case 82 : //R Far
                    camera.position.y = camera.position.y + delta;
                    break;
                case 70 : //F Near 
                    camera.position.y = camera.position.y - delta;
                    break;
                // Case YAW
                case 37 : //arrowLeft
                    camera.rotation.y = camera.rotation.y + yawMove;
                    break;
                case 39 : //arrowRight
                    camera.rotation.y = camera.rotation.y - yawMove;
                    break;
                // Case PITCH
                case 38 : //arrowUp
                    camera.rotation.x = camera.rotation.x + yawMove;
                    break;
                case 40 : //arrowDown
                    camera.rotation.x = camera.rotation.x - yawMove;
                    break;
            }
            document.addEventListener('keyup',onDocumentKeyUp,false);
            music.play();
        }
        function onDocumentKeyUp(event){
            document.removeEventListener('keydown',onDocumentKeyDown,false);
        }
        // if (mesh) mesh.rotation.y += 0.01;
        // if (mesh2) mesh2.rotation.y += 0.01;
        // if (mesh3) mesh3.rotation.y += 0.01;
        // if (bench_mesh) bench_mesh.rotation.y += 0.01;
        if(car_mesh) {
            if(car_mesh.position.z <= plane.position.z - 48) {
                car_mesh.rotation.y = Math.PI;
                mundur = 0;
            }
            if(car_mesh.position.z >= plane.position.z + 48) {
                car_mesh.rotation.y = Math.PI;
                mundur = 1;
            }
            if(mundur == 0) car_mesh.position.z += 0.1; 
            else car_mesh.position.z -= 0.1;
        }
    	renderer.render(scene, camera);
    	requestAnimationFrame(render);
    }
    </script>
</body>
</html>
